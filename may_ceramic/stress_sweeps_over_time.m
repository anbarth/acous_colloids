cmap = viridis(256); 
myColor = @(t,tmax) cmap(round(1+255*t/tmax),:);
dataTable = may_ceramic_06_06;

sweeps44 = {phi44_05_29.low_sweep1,phi44_05_29.sweep1,...
    phi44_05_29.sweep2,phi44_05_29.sweep3,...
    phi44_05_29.sweep4,phi44_05_29.sweep5,...
    phi44_05_29.sweep6,phi44_05_29.sweep7,...
    phi44_05_29.low_sweep3,...
    phi44_05_29.low_sweep6,phi44_05_29.low_sweep8,phi44_05_29.sweep8};
sweeps48 = {phi48_05_31.low_sweep1,phi48_05_31.sweep1, ...
    phi48_05_31.low_sweep5,...
    phi48_05_31.sweep2,phi48_05_31.sweep3,...
    phi48_05_31.sweep4,phi48_05_31.sweep5,...
    phi48_05_31.sweep6,phi48_05_31.sweep7,...
    phi48_05_31.sweep8,phi48_05_31.sweep9};
sweeps52 = {phi52_05_29.low_sweep1,phi52_05_29.sweep1,...
    phi52_05_29.sweep2,phi52_05_29.sweep3,...
    phi52_05_29.sweep4,phi52_05_29.sweep5,...
    phi52_05_29.sweep6,phi52_05_29.sweep7,...
    phi52_05_29.low_sweep4,...
    phi52_05_29.low_sweep6,phi52_05_29.low_sweep7,...
    phi52_05_29.low_sweep8,phi52_05_29.sweep8};
sweeps54 = {phi54_06_01.low_sweep1,phi54_06_01.sweep1,...
    phi54_06_01.sweep2,phi54_06_01.sweep3,...
    phi54_06_01.sweep4,phi54_06_01.sweep5,...
    phi54_06_01.sweep6,phi54_06_01.sweep7,...
    phi54_06_01.sweep8,phi54_06_01.sweep9,...
    phi54_06_01.low_sweep4,...
    phi54_06_01.low_sweep8,phi54_06_01.low_sweep10,phi54_06_01.sweep10};
sweeps56 = {phi56_05_31.low_sweep1,phi56_05_31.sweep1,...
    phi56_05_31.sweep2,phi56_05_31.sweep3,...
    phi56_05_31.sweep4,...
    phi56_05_31.low_sweep4,phi56_05_31.sweep5};
sweeps59 = {phi59_05_30.sweep1,phi59_05_30.low_sweep1,...
    phi59_05_30.sweep2,phi59_05_30.sweep3,...
    phi59_05_30.sweep4,phi59_05_30.sweep5,...
    phi59_05_30.sweep6,phi59_05_30.sweep7,...
    phi59_05_30.sweep8,phi59_05_30.sweep9,...
    phi59_05_30.sweep10,phi59_05_30.sweep11,...
    phi59_05_30.low_sweep2,...
    phi59_05_30.low_sweep5,phi59_05_30.low_sweep7,...
    phi59_05_30.low_sweep9,phi59_05_30.low_sweep11,...
    phi59_05_30.low_sweep12,phi59_05_30.sweep12};


allSweeps = {sweeps44,sweeps48,sweeps52,sweeps54,sweeps56,sweeps59};

%phi_list = [44,48,52,54,56,58,59,59.5];
phi_list_dataTable = [0.4396, 0.4811, 0.5193, 0.5398, 0.5607, 0.5898];

phi_num = 6;
mySweeps = allSweeps{phi_num};

figure; hold on;
ax1 = gca;
ax1.XScale = 'log';
%ax1.YScale = 'log';
colormap(ax1,cmap)

% set up initial stuff
t_init = mySweeps{1}.datetime(1);
[sigma_init1,eta_init1] = getStressSweep(mySweeps{1});
[sigma_init2,eta_init2] = getStressSweep(mySweeps{2});
initialSweep = [sigma_init1,eta_init1;sigma_init2,eta_init2];



tmax = minutes(mySweeps{end}.datetime(1)-t_init);
if tmax<0
    tmax = tmax+24*60;
end

for ii = 1:length(mySweeps)
    mySweep = mySweeps{ii};
    [mySigma,myEta] = getStressSweep(mySweep);
    delta_t = minutes(mySweep.datetime(1)-t_init);
    if delta_t<0
        delta_t = delta_t+24*60;
    end
    %plot(ax1,mySigma,myEta,'-o','LineWidth',1,'Color',myColor(delta_t,tmax));

    [mySigma_intersect,delta_eta] = subtractStressSweeps([mySigma,myEta],initialSweep);
    plot(ax1,mySigma_intersect,delta_eta,'-o','LineWidth',1,'Color',myColor(delta_t,tmax));
end

myData = dataTable(dataTable(:,1)==phi_list_dataTable(phi_num) & dataTable(:,3)==0, :);
sigma = myData(:,2);
eta = myData(:,4);

% sort in order of ascending sigma
[sigma,sortIdx] = sort(sigma,'ascend');
eta = eta(sortIdx);

%plot(ax1,sigma,eta, '-dk','LineWidth',3);